from detection.detection_functionality.triangle_check import get_triangle

import pandas as pd
import pytest
import json

@pytest.fixture
def ascending_triangle_price_data():
    data = json.loads(r'[{"open":97,"close":100,"high":101,"low":96,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":100,"close":102,"high":103,"low":99,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":102,"close":103,"high":103,"low":101,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":103,"close":104,"high":105,"low":102,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":104,"close":101,"high":105,"low":100,"volume":2,"time":"2020-02-0614:30:00","high_low":1},{"open":101,"close":98,"high":102,"low":98,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":98,"close":95,"high":99,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":95,"close":96,"high":97,"low":93,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":96,"close":90,"high":96,"low":88,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":90,"close":87,"high":90,"low":86,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":87,"close":88,"high":89,"low":85,"volume":2,"time":"2020-02-0614:30:00","high_low":-1},{"open":88,"close":87,"high":89,"low":86,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":87,"close":93,"high":94,"low":86,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":93,"close":92,"high":94,"low":91,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":92,"close":95,"high":96,"low":92,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":95,"close":99,"high":100,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":99,"close":103,"high":104,"low":98,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":103,"close":104,"high":105,"low":101,"volume":2,"time":"2020-02-0614:30:00","high_low":1},{"open":104,"close":97,"high":101,"low":96,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":97,"close":96,"high":98,"low":96,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":96,"close":97,"high":98,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":97,"close":92,"high":97,"low":91,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":92,"close":90,"high":93,"low":89,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":90,"close":91,"high":91,"low":90,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":91,"close":93,"high":94,"low":89,"volume":2,"time":"2020-02-0614:30:00","high_low":-1},{"open":93,"close":92,"high":94,"low":91,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":92,"close":95,"high":96,"low":92,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":95,"close":100,"high":101,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":100,"close":104,"high":105,"low":100,"volume":2,"time":"2020-02-0614:30:00","high_low":1},{"open":104,"close":95,"high":99,"low":95,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":95,"close":96,"high":96,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":96,"close":97,"high":98,"low":95,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":97,"close":95,"high":97,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":95,"close":94,"high":95,"low":93,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":94,"close":95,"high":95,"low":93,"volume":2,"time":"2020-02-0614:30:00","high_low":-1},{"open":95,"close":96,"high":97,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":96,"close":97,"high":97,"low":95,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":97,"close":98,"high":99,"low":96,"volume":2,"time":"2020-02-0614:30:00","high_low":0}]')
    data = pd.json_normalize(data)
    return data

@pytest.fixture
def descending_triangle_price_data():
    data = json.loads(r'[{"open":97,"close":100,"high":101,"low":96,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":100,"close":102,"high":103,"low":99,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":102,"close":103,"high":103,"low":101,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":103,"close":104,"high":105,"low":102,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":104,"close":101,"high":105,"low":100,"volume":2,"time":"2020-02-0614:30:00","high_low":1},{"open":101,"close":98,"high":102,"low":98,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":98,"close":95,"high":99,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":95,"close":96,"high":97,"low":93,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":96,"close":93,"high":96,"low":92,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":93,"close":90,"high":94,"low":88,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":90,"close":87,"high":90,"low":86,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":87,"close":88,"high":89,"low":85,"volume":2,"time":"2020-02-0614:30:00","high_low":-1},{"open":88,"close":87,"high":89,"low":86,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":87,"close":93,"high":94,"low":86,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":93,"close":92,"high":94,"low":91,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":92,"close":95,"high":96,"low":92,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":95,"close":98,"high":99,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":1},{"open":98,"close":96,"high":98,"low":96,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":96,"close":97,"high":98,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":97,"close":92,"high":97,"low":91,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":92,"close":88,"high":93,"low":88,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":88,"close":89,"high":89,"low":87,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":89,"close":87,"high":89,"low":85,"volume":2,"time":"2020-02-0614:30:00","high_low":-1},{"open":87,"close":88,"high":89,"low":86,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":88,"close":91,"high":92,"low":88,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":91,"close":93,"high":94,"low":91,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":93,"close":92,"high":94,"low":91,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":92,"close":94,"high":95,"low":92,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":94,"close":93,"high":95,"low":92,"volume":2,"time":"2020-02-0614:30:00","high_low":1},{"open":93,"close":91,"high":93,"low":90,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":91,"close":90,"high":91,"low":89,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":90,"close":87,"high":91,"low":87,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":87,"close":86,"high":89,"low":85,"volume":2,"time":"2020-02-0614:30:00","high_low":-1},{"open":86,"close":90,"high":91,"low":86,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":90,"close":91,"high":92,"low":90,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":91,"close":92,"high":92,"low":90,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":92,"close":91,"high":92,"low":90,"volume":2,"time":"2020-02-0614:30:00","high_low":0}]')
    data = pd.json_normalize(data)
    return data

@pytest.fixture
def symmetrical_triangle_price_data():
    data = json.loads(r'[{"open":97,"close":100,"high":101,"low":96,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":100,"close":102,"high":103,"low":99,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":102,"close":103,"high":103,"low":101,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":103,"close":104,"high":105,"low":102,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":104,"close":101,"high":105,"low":100,"volume":2,"time":"2020-02-0614:30:00","high_low":1},{"open":101,"close":98,"high":102,"low":98,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":98,"close":95,"high":99,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":95,"close":96,"high":97,"low":93,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":96,"close":93,"high":96,"low":92,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":93,"close":90,"high":94,"low":88,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":90,"close":87,"high":90,"low":86,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":87,"close":88,"high":89,"low":85,"volume":2,"time":"2020-02-0614:30:00","high_low":-1},{"open":88,"close":87,"high":89,"low":86,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":87,"close":93,"high":94,"low":86,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":93,"close":92,"high":94,"low":91,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":92,"close":95,"high":96,"low":92,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":95,"close":99,"high":100,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":99,"close":102,"high":103,"low":98,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":102,"close":97,"high":103,"low":96,"volume":2,"time":"2020-02-0614:30:00","high_low":1},{"open":97,"close":96,"high":98,"low":96,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":96,"close":97,"high":98,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":97,"close":92,"high":97,"low":91,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":92,"close":88,"high":93,"low":88,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":88,"close":89,"high":89,"low":87,"volume":2,"time":"2020-02-0614:30:00","high_low":-1},{"open":88,"close":91,"high":92,"low":88,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":91,"close":93,"high":94,"low":91,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":93,"close":92,"high":94,"low":91,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":92,"close":95,"high":96,"low":92,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":95,"close":100,"high":101,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":1},{"open":100,"close":95,"high":100,"low":95,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":95,"close":96,"high":96,"low":94,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":96,"close":97,"high":98,"low":95,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":97,"close":93,"high":97,"low":92,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":93,"close":91,"high":93,"low":90,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":91,"close":90,"high":91,"low":89,"volume":2,"time":"2020-02-0614:30:00","high_low":-1},{"open":90,"close":93,"high":94,"low":90,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":93,"close":94,"high":95,"low":91,"volume":2,"time":"2020-02-0614:30:00","high_low":0},{"open":94,"close":95,"high":95,"low":93,"volume":2,"time":"2020-02-0614:30:00","high_low":0}]')
    data = pd.json_normalize(data)
    return data

def test_gets_ascending_triangle(ascending_triangle_price_data):
    triangle = get_triangle(ascending_triangle_price_data, 100)

    assert triangle.type == 1

def test_gets_descending_triangle(descending_triangle_price_data):
    triangle = get_triangle(descending_triangle_price_data, 100)

    assert triangle.type == -1

def test_gets_symmetrical_triangle(symmetrical_triangle_price_data):
    triangle = get_triangle(symmetrical_triangle_price_data, 100)

    assert triangle.type == 0